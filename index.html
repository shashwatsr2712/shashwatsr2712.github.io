<!DOCTYPE html>
<html>
<head>
	<title>coolPlay</title>
	<link rel="icon" type="image/ico" href="images/icon1.ico"/>
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"/>
	<script>alert("This project is currently in development phase. Suggestions/feedbacks are welcome. Click on the Logo for details.");</script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
	<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.4/angular.min.js"></script>
	<script src="id3js/id3-min.js" type="text/javascript"></script>
	<style>
	#bgimg{background:url('images/bg1.jpg') no-repeat center center;background-size:cover;}
	#bgimg2{background:url('images/bg2.jpg') no-repeat center center;background-size:cover;}
	a:link{color:black;}
	#foot{
	width:100%;padding:15px 0px 5px 0px;margin-top:200px;background-color:#D8D7CD;}
	</style>
	<meta name="viewport" content="width=device-width,initial-scale=1"/>
</head>

<body id="bgimg">
	<nav class="navbar navbar-dark bg-dark fixed-top">
	<a href="" class="navbar-brand" data-toggle="modal" data-target="#myModal"><img src="images/cplogon4m1.png" alt="coolPlay Logo"/></a>
	<button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#myNavbar">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="myNavbar">
		<ul class="navbar-nav" id="ham"><br/>
			<div class="nav-item .d-none .d-sm-block">
				<button class="rpt btn btn-outline-secondary" onclick="repeatToggle()"><b>Repeat</b></button>
				<input class="btn btn-sm btn-info" type="file" id="file" onchange="loadFile(this)"><br/>
			</div>
			<!--<li>Here's your playList </li>-->
		</ul>
	</div>
	</nav><br/><br/><br/><br/>

	<!--Modal for About section-->
	<div id="myModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header" style="background-color:#2EB1FF;">
					<h3 class="modal-title"><center><img src="images/cplogon3m.png" alt="coolPlay Logo" class="img-fluid rounded"/></center></h3>
					<button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>
				<div class="modal-body" style="font-family:times;" id="bgimg2">
					<p><h4><strong>coolPlay</strong> allows you to make a playlist of your favourite songs by selecting them from your device. So just <strong>Add & Play</strong>.</h4></p><br/>
					<p><h4><b>Get Started: </b>
						<ul type="circle">
							<h4>1.Add new item to the list by selecting a file from your device.</h4>
							<h4>2.Select any item from the list to make its metadata (album art, artist, album) and audio controls visible</h4>
							<h4>3.Click on <strong>Repeat</strong> to turn repetition on. Click on it again to turn it off.</h4>
						</ul></h4></p>
					<p><h4>Simple enough, isn't it?</h4></p><br/>
					<p><h4><i>This project is currently in development phase. More features and improvements coming soon...</i></h4></p>
				</div>
				<div class="modal-footer" id="bgimg">
					<button type="button" class="btn btn-info" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<div class="container">
	<center><figure class="figure" id="bgimg2"><!--initially style="background-color:#2EB1FF;" instead of bg-img-->
		<img id="picture" src="images/cplogon3m1.png" alt="album art " class="figure-img img-fluid img-thumbnail rounded"/>
		<figcaption class="figure-caption" style="font-family:courier;color:black;font-size:1.1em;text-align:center;">
			<div><audio id="sound" controls="controls" onended="autoplayNext()"></audio>
			<!--<a href="javascript:autoplayNext();"><i class="icon-large fa fa-hand-o-right"></i></a>--></div><br/><br/>
			<p><b>Title:</b> <span id="title">__________</span></p>
			<p><b>Artist:</b> <span id="artist">__________</span></p>
			<p><b>Album:</b> <span id="album">__________</span></p>
		</figcaption>
	</figure></center>
	
	<hr> <!--horizontal divider line-->
	
	<input class="btn btn-info" type="file" id="file" onchange="loadFile(this)"><br/><br/>
	<h3 style="font-family:courier;color:black;font-style:bold;">PlayList <i class="fa fa-arrow-circle-down"></i>&nbsp;
	<button class="rpt btn btn-outline-secondary" onclick="repeatToggle()"><b>Repeat</b></button></h3><br/>
	<ul id="playlist" type="square" style="font-size:1.2em;font-style:italic;color:black;">
		<!--<li>Here's your playList </li>-->
	</ul>
	</div>
	
	<footer id="foot">
	<div class="container">
		<center><p><b><i>coolPlay &copy;</i> | ALL RIGHTS RESERVED. | CONTACT US: <a href="mailto:shashwatsr2712@gmail.com"><i>shashwatsr2712@gmail.com</i></a></b></p></center>
	</div>
	</footer>
	
	<script>
    /**
     Loading the tags using XHR.
     **/
     
    //sample.mp3 sits on your domain
    /*ID3.loadTags("sample.mp3", function() {
      showTags("sample.mp3");
    }, {
      tags: ["title","artist","album","picture"]
    });*/
    
    var filesLog=[]; //this stores the 'file type' info of all items added to playlist
    var fileNamesLog=[]; //this stores the corresponding file names of all items (from metadata;not from filename)
    /**
     * Loading the tags using the FileAPI.
     */
    function loadFile(inp) {
      var file = inp.files[0];
      var url = file.urn || file.name;
      
      filesLog.push(file);

	/*Adding item to Playlist begins*/
      var count=document.querySelectorAll("li").length; //count stores the total number of list (li) tags. Actual number of songs is half of that.
      var item=document.createElement("li");var item2=document.createElement("a");
      var str="javascript:highlightIt("+count/2+")";
      item2.setAttribute("href",str);
      item2.appendChild(document.createTextNode(url));
      item2.appendChild(document.createElement("br"));item2.appendChild(document.createElement("br"));
      item.appendChild(item2);
      document.getElementById("playlist").appendChild(item);
	/*Adding item to Playlist done*/
	
	/*Adding item to Playlist in navbar begins*/
	var itemn=document.createElement("li");var itemn2=document.createElement("a");
      itemn2.setAttribute("href",str);
      itemn2.appendChild(document.createTextNode(url));
      itemn2.appendChild(document.createElement("br"));
      itemn2.setAttribute("class","nav-link");
	itemn.setAttribute("class","nav-item");
      itemn.appendChild(itemn2);
      document.getElementById("ham").appendChild(itemn); 
      /*Adding item to Playlist in navbar done*/
      
      ID3.loadTags(url, function() {
        showTags(url,file,count/2);
         }, {
        tags: ["title","artist","album","picture"],
	 dataReader: ID3.FileAPIReader(file)
       });
       // not really needed in this exact case, but since it is really important in other cases,
       // don't forget to revoke the blobURI when you don't need it
       sound.onend = function(e) {
       URL.revokeObjectURL(this.src);
	}
    }
    
    
    
    // this function displays all tags from music file along with audio controls
    function highlightIt(index){ 
	var url1=filesLog[index].urn || filesLog[index].name;
	ID3.loadTags(url1, function() {
        showTags(url1,filesLog[index],index);
         }, {
        tags: ["title","artist","album","picture"],
	 dataReader: ID3.FileAPIReader(filesLog[index])
       });
    }
    
    
    
    // Turn on or off repetition
    function repeatToggle(){
	var aud=document.getElementsByTagName("audio");
	var bt=document.getElementsByClassName("rpt");
	if(bt[0].getAttribute("class")=="rpt btn btn-outline-secondary"){
		aud[0].setAttribute("loop","loop");
		bt[0].setAttribute("class","rpt btn btn-primary");bt[1].setAttribute("class","rpt btn btn-primary");
	}
	else{
		aud[0].removeAttribute("loop");
		bt[0].setAttribute("class","rpt btn btn-outline-secondary");bt[1].setAttribute("class","rpt btn btn-outline-secondary");
	}
    }
    
    
    
    // For Autoplay
    function autoplayNext(){
	var count=document.querySelectorAll("li").length;
	var titl=String(document.getElementById('title').textContent);
	var i;
	for(i=0;i<count/2;i++){
		if(fileNamesLog[i]==titl&&i!=count/2-1){ //if the ended audio is not the last item of list, play the next item
			highlightIt(i+1);}
		else if(fileNamesLog[i]===titl&&i==count/2-1){ //if ended audio is the last item, play the first item
			highlightIt(0);}
		else
			continue; //not needed
	}
    };
    
    
    
    /**
     * Generic function to get the tags after they have been loaded after upload
     */
    function showTags(url,file,index) {
      var tags = ID3.getAllTags(url);
      console.log(tags);
      document.getElementById('title').textContent = tags.title || "";
      fileNamesLog[index]=tags.title || "";
      document.getElementById('artist').textContent = tags.artist || "";
      document.getElementById('album').textContent = tags.album || "";
      var image = tags.picture;
      if (image) {
        var base64String = "";
        for (var i = 0; i < image.data.length; i++) {
            base64String += String.fromCharCode(image.data[i]);
        }
        var base64 = "data:" + image.format + ";base64," +
                window.btoa(base64String);
	document.getElementById('picture').setAttribute('src',base64);
      } 
      else {
        document.getElementById('picture').setAttribute('src','images/cplogon3m1.png');
      }
      var sound = document.getElementById('sound');
      sound.src = URL.createObjectURL(file);
      sound.play();
    }
</script>
</body>
</html>
