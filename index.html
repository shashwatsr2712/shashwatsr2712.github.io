-<!DOCTYPE html>
<html>
<head>
	<title>coolPlay</title>
	<link rel="icon" type="image/ico" href="images/cplogowcIcon.ico"/>
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous"/>
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"/>
	<script>alert("This project is currently in development phase. Suggestions/feedbacks are welcome. Click on the Logo for details.");</script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
	<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.4/angular.min.js"></script>
	<script src="id3js/id3-min.js" type="text/javascript"></script>
	<style>
	#bgimg{background:url('images/bg1.jpg') no-repeat center center;background-size:cover;}
	#bgimg2{background:url('images/bg2.jpg') no-repeat center center;background-size:cover;}
	a:link{color:black;}
	
	/*This is the fix for non-scrolling navbar hamburger menu*/
	.fixed-top .navbar-collapse {
	max-height:400px;
	overflow-y:auto;
		/*webkit-overflow-scrolling:touch;*/
	}
	
	/* Style all font awesome icons */
	.awesome {
	padding: 10px;
	font-size: 30px;
	width: 50px;
	text-align: center;
	text-decoration: none;
	border-radius:50%;
	}
	/* Hover effect */
	.fab:hover {
	opacity: 0.7;
	}

	/* Set a specific color for each brand */
	.fa-facebook {
	background: #3B5998;
	}
	.fa-twitter {
	background: #55ACEE;
	}
	.fa-google {
	background: #dd4b39;
	}
	.fa-linkedin {
	background: #007bb5;
	}
	.fa-quora {
	background: #AA2200;
	}
	
	#foot{
	width:100%;padding:5px 0px 10px 0px;margin-top:200px;background-color:#D8D7CD;}
	</style>
	<meta name="viewport" content="width=device-width,initial-scale=1"/>
	<!--IMAGES: Icon:cplogowcIcon.ico; Navbar-logo:cplogowcNavLogo.png; Modal:cplogorModal.png; Default-Album-Art:cplogorArt.png;-->
</head>

<body>
	<!--z-index has been used in navbar and alert divs to position alert divs on top of navbars-->
	<nav class="navbar fixed-top navbar-light bg-warning" style="z-index:1;">
	<a href="" class="navbar-brand" data-toggle="modal" data-target="#myModal" style="font-style:italic;"><img src="images/cplogowcNavLogo.png" alt="coolPlay Logo"/> &nbsp;COOLPLAY&trade;</a>
	<div class="ml-auto">
		<button type="button" id="rpt" class="btn btn-outline-danger" onclick="repeatToggle()"><b>Repeat</b></button>
		<button type="button" class="navbar-toggler navbar-toggler-right" data-toggle="collapse" data-target="#myNavbar" aria-controls="myNavbar" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
	</div>
	<div class="collapse navbar-collapse" id="myNavbar">
		<ul class="navbar-nav mr-auto" id="ham"><br/>
			<div class="nav-item .d-none .d-sm-block">
				<input class="btn btn-sm btn-info" type="file" id="file" onchange="loadFile(this)"><br/>
			</div>
			<!--<li>Here's your playList </li>-->
		</ul>
	</div>
	</nav>
	
	<!--"bgimg" div begins-->
	<div id="bgimg">
	<br/><br/><br/><br/>

	<!--Success alert. The css fixes it just below navbar even while scrolling-->
	<div id="addSuccess" class="alert alert-success" style="display:none;position:fixed;top:0px;width:100%;height:66px;margin-bottom:0px;z-index:2;">
		<strong>Success!</strong> Item added to Playlist.
	</div>
	
	<!--Error alert. The css fixes it just below navbar even while scrolling-->
	<div id="errorFormat" class="alert alert-danger" style="display:none;position:fixed;top:0px;width:100%;height:66px;margin-bottom:0px;z-index:2;">
		<strong>Error!</strong> File Format not supported.
	</div>
	
	<!--Error alert. The css fixes it just below navbar even while scrolling-->
	<div id="errorRepetition" class="alert alert-danger" style="display:none;position:fixed;top:0px;width:100%;height:66px;margin-bottom:0px;z-index:2;">
		<strong>Oops!</strong> File has already been added.
	</div>

	<!--Modal for About section-->
	<div id="myModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header" style="background-color:#000000;">
					<h3 class="modal-title"><center><img src="images/cplogorModal.png" alt="coolPlay Logo" class="img-fluid rounded"/></center></h3>
					<button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>
				<div class="modal-body" style="font-family:times;" id="bgimg2">
					<p><h6><strong>coolPlay</strong> allows you to make a playlist of your favourite songs by selecting them from your device. So just <strong>Add & Play</strong>.</h6></p><br/>
					<p><h6><b>Get Started: </b>
						<ul type="circle">
							<h6>1.Add new item to the list by selecting a file from your device.</h6>
							<h6>2.Select any item from the list to make its metadata (album art, artist, album) and audio controls visible</h6>
							<h6>3.Click on <strong>Repeat</strong> to turn repetition on. Click on it again to turn it off.</h6>
							<h6>4.Playlist can also be accessed from navigation bar.</h6>
						</ul></h6></p>
					<p><h6>Simple enough, isn't it?</h6></p><br/>
					<p><h6><i>This project is currently in development phase. More features and improvements coming soon...</i></h6></p>
				</div>
				<div class="modal-footer" id="bgimg">
					<button type="button" class="btn btn-info" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<!--Container opens-->
	<div class="container">
	<!--AUDIO-->
	<center id="soundD"><figure class="figure" id="bgimg2"><!--initially style="background-color:#2EB1FF;" instead of bg-img-->
		<img id="picture" src="images/cplogorArt.png" alt="coolPlay logo" class="figure-img img-fluid img-thumbnail rounded"/>
		<figcaption class="figure-caption" style="font-family:courier;color:black;font-size:1.1em;text-align:center;overflow:auto;">
			<a href="javascript:playPrev();"><i class="far fa-hand-point-left fa-2x"></i></a>
			<audio id="sound" controls="controls" onended="autoplayNext()"></audio>
			<a href="javascript:autoplayNext();"><i class="far fa-hand-point-right fa-2x"></i></a><br/><br/>
			<p><b>Title:</b> <span class="title">__________</span></p>
			<p id="Ar"><b>Artist:</b> <span id="artist">__________</span></p>
			<p id="Al"><b>Album:</b> <span id="album">__________</span></p>
		</figcaption>
	</figure></center>
	<!--AUDIO-->
	
	<!--VIDEO-->
	<center id="mediaD" style="display:none">
		<video id="media" width="100%" controls="controls" onended="autoplayNext()"></video><br/><br/>
		<a href="javascript:playPrev();"><i class="far fa-hand-point-left fa-2x"></i></a>
		<a href="javascript:autoplayNext();"><i class="far fa-hand-point-right fa-2x"></i></a><br/><br/>
		<p style="font-family:courier;color:black;font-size:1.1em;text-align:center;overflow:auto;"><b>Title:</b><span class="title">__________</span></p>
	</center>
	<!--VIDEO-->
	
	<hr> <!--horizontal divider line-->
	
	<input class="btn btn-info" type="file" id="file" onchange="loadFile(this)"><br/><br/><br/>
	<h3 style="font-family:courier;color:black;font-style:bold;">
		<a id="playlistToggle" class="fa fa-arrow-circle-down" href="javascript:showHidePlaylist();" style="text-decoration:none;"></a>&nbsp;PlayList <span id="countBadge" class="badge badge-primary"></span>
	</h3>
	<ul id="playlist" class="list-group" type="square" style="font-size:1.1em;font-style:italic;color:black;word-wrap:break-word;">
		<!--<li>Here's your playList </li>-->
	</ul>
	</div>
	<!--Container ends-->
	
	<footer id="foot">
		<center>
			<p><h6 style="display:inline;font-style:italic;">COOLPLAY&copy; 2019&nbsp;|&nbsp;WRITE TO US:</h6> <a href="mailto:shashwatsr2712@gmail.com">shashwatsr2712@gmail.com</a></p>
			<a href="https://twitter.com/ShashwatSuny" target="_blank" class="awesome fab fa-twitter" style="color:white;text-decoration:none;"></a>&nbsp;
			<a href="https://www.facebook.com/shashwat.srivastav.3" target="_blank" class="awesome fab fa-facebook" style="color:white;text-decoration:none;"></a>
			<a href="https://github.com/shashwatsr2712/" target="_blank" class="awesome fab fa-github" style="font-size:40px;color:black;text-decoration:none;"></a>&nbsp;
			<a href="https://www.linkedin.com/in/shashwatsr2712" target="_blank" class="awesome fab fa-linkedin" style="color:white;text-decoration:none;"></a>&nbsp;
			<a href="https://www.quora.com/profile/%E0%A4%B6%E0%A4%BE%E0%A4%B6%E0%A5%8D%E0%A4%B5%E0%A4%A4-%E0%A4%B6%E0%A5%8D%E0%A4%B0%E0%A5%80%E0%A4%B5%E0%A4%BE%E0%A4%B8%E0%A5%8D%E0%A4%A4%E0%A4%B5-Shashwat-Srivastava" target="_blank" class="awesome fab fa-quora" style="color:white;text-decoration:none;"></a>
		</center>
	</footer>
	</div>
	<!--"bgimg" div ends-->
	
	<script>
    /**
     Loading the tags using XHR.
     **/
     
    //sample.mp3 sits on your domain
    /*ID3.loadTags("sample.mp3", function() {
      showTags("sample.mp3");
    }, {
      tags: ["title","artist","album","picture"]
    });*/


    var filesLog=[]; //this stores the 'file type' info of all items added to playlist
    var fileNamesLog=[]; //this stores the corresponding titles of all items. For audios, it's from metadata. For videos (and audios without title in metadata), it's the original url.
    /**
     * Loading the tags using the FileAPI.
     */
    function loadFile(inp) {
      var file = inp.files[0];
      var url = file.urn || file.name;
      var count=document.querySelectorAll("li").length; //count stores the total number of list (li) tags. Actual number of songs is half of that.
      
      //Check if added file is of valid extension (audio/video) 
      var ext=url.slice(-3);
      if(ext!="mp3"&&ext!="wav"&&ext!="wma"&&ext!="ogg"&&ext!="mp4"&&ext!="mkv"&&ext!="ebm"){
		document.getElementById('errorFormat').style.display="block";
		setTimeout(function(){document.getElementById('errorFormat').style.display="none";},3000);
		return;
      }
      
      //Check if added file already present in Playlist so far
      var i;
      for(i=0;i<count/2;i++){
	if(filesLog[i].name==url || filesLog[i].urn==url){
		document.getElementById('errorRepetition').style.display="block";
		setTimeout(function(){document.getElementById('errorRepetition').style.display="none";},3000);
		return;
	}
      }
      
      filesLog.push(file);

	/*Adding item to Playlist begins*/
      if(count==0){ //As soon as first item added to playlist, turn the arrow face up
	document.getElementById('playlistToggle').setAttribute("class","fa fa-arrow-circle-up");}
      var item=document.createElement("li");var item2=document.createElement("a");
      var str="javascript:highlightIt("+count/2+")";
      item2.setAttribute("href",str);
      item2.appendChild(document.createTextNode((count/2+1)+". "+url));
      item2.appendChild(document.createElement("br"));item2.appendChild(document.createElement("br"));
      item.setAttribute("class","list-group-item list-group-item-primary");item.setAttribute("style","padding-bottom:0px;");
      item.appendChild(item2);
      document.getElementById("playlist").appendChild(item);
	/*Adding item to Playlist done*/
	
	/*Adding item to Playlist in navbar begins*/
      var itemn=document.createElement("li");var itemn2=document.createElement("a");
      itemn2.setAttribute("href",str);
      itemn2.appendChild(document.createTextNode(url));
      itemn2.appendChild(document.createElement("br"));
      itemn2.setAttribute("class","nav-link");
      itemn.setAttribute("class","nav-item");
      itemn.appendChild(itemn2);
      document.getElementById("ham").appendChild(itemn);
      /*Adding item to Playlist in navbar done*/
      
      //Displaying count of media in Playlist
      document.getElementById("countBadge").textContent=count/2 +1; 
      if(count==0){
	document.getElementById("countBadge").setAttribute("data-toggle","tooltip");document.getElementById("countBadge").setAttribute("data-placement","top");document.getElementById("countBadge").setAttribute("title","Number of items in Playlist");
      }
      
      //For first selection of file, play the song/video (for further additions, item is only 'added to playlist'; this ensures uninterrupted playback while making playlist.)
      if(count==0){
      highlightIt(count/2);
      }
       
       // not really needed in this exact case, but since it is really important in other cases,
       // don't forget to revoke the blobURI when you don't need it
       /*sound.onend = function(e) {
       URL.revokeObjectURL(this.src);
	}*/
	
	//Alert on successful addition to playlist
	document.getElementById('addSuccess').style.display="block";
	setTimeout(function(){document.getElementById('addSuccess').style.display="none";},3000);
    }
    
    
    
    // this function displays all tags from music file along with audio/video controls
    function highlightIt(index){ 
	var url1=filesLog[index].urn || filesLog[index].name;
	ID3.loadTags(url1, function() {
        showTags(url1,filesLog[index],index);
         }, {
        tags: ["title","artist","album","picture"],
	 dataReader: ID3.FileAPIReader(filesLog[index])
       });
    }
    
    
    
    // Turn on or off repetition
    function repeatToggle(){
	var aud=document.getElementById("sound");
	var vid=document.getElementById("media");
	var bt=document.getElementById("rpt");
	if(bt.getAttribute("class")=="btn btn-outline-danger"){
		aud.setAttribute("loop","loop");vid.setAttribute("loop","loop");
		bt.setAttribute("class","btn btn-primary");
	}
	else{
		aud.removeAttribute("loop");vid.removeAttribute("loop","loop");
		bt.setAttribute("class","btn btn-outline-danger");
	}
    }
    
    
    
    // For Autoplay/Playing Next Song
    function autoplayNext(){
	var count=document.querySelectorAll("li").length;
	var titl=String(document.getElementsByClassName('title')[0].textContent); // For audio
	var titl1=String(document.getElementsByClassName('title')[1].textContent); //For video
	var i;
	/*If audio is playing*/
	if(!isVideoActive()){
		for(i=0;i<count/2;i++){
			if(fileNamesLog[i]==titl&&i!=count/2-1){ //if the ended audio is not the last item of list, play the next item
				highlightIt(i+1);
				break;}
			else if(fileNamesLog[i]===titl&&i==count/2-1){ //if ended audio is the last item, play the first item
				highlightIt(0);
				break;}
			else{
				continue;} //not needed
		}
	}
	/*If video is playing*/
	else{
		for(i=0;i<count/2;i++){
			if(fileNamesLog[i]==titl1&&i!=count/2-1){ //if the ended video is not the last item of list, play the next item
				highlightIt(i+1);
				break;}
			else if(fileNamesLog[i]===titl1&&i==count/2-1){ //if ended video is the last item, play the first item
				highlightIt(0);
				break;}
			else{
				continue;} //not needed
		}
	}
    }
    
    
    
    // For playing previous song if current time < 3 secs; else play same song again
    function playPrev(){
	var count=document.querySelectorAll("li").length;
	var titl=String(document.getElementsByClassName('title')[0].textContent); //For audio
	var titl1=String(document.getElementsByClassName('title')[1].textContent); //For video
	var aud=document.getElementById("sound");
	var vid=document.getElementById("media");
	var i;
	/*If audio is playing*/
	if(!isVideoActive()){
		if(aud.currentTime>3){ //currentTime gives the current time of audio in seconds
			aud.currentTime=0;
		}
		else{
			for(i=0;i<count/2;i++){
				if(fileNamesLog[i]==titl&&i!=0){ //if current media is not the first item of list, play the previous item
					highlightIt(i-1);
					break;}
				else if(fileNamesLog[i]==titl&&i==0){ //if current media is the first item, play the last item
					highlightIt(count/2-1);
					break;}
				else{
					continue;} //not needed
			}
		}
	}
	/*If video is playing*/
	else{
		if(vid.currentTime>3){ //currentTime gives the current time of video in seconds
			vid.currentTime=0;
		}
		else{
			for(i=0;i<count/2;i++){
				if(fileNamesLog[i]==titl1&&i!=0){ //if current media is not the first item of list, play the previous item
					highlightIt(i-1);
					break;}
				else if(fileNamesLog[i]==titl1&&i==0){ //if current media is the first item, play the last item
					highlightIt(count/2-1);
					break;}
				else{
					continue;} //not needed
			}
		}
	}
    }
    
    
    
    /*This function shows/hides the Playlist on clicking the fa-arrow icon*/
    function showHidePlaylist(){
	if(document.querySelectorAll('li').length!=0){
		var pl=document.getElementById('playlist');
		if(document.getElementById('playlist').style.display=="none"){
			pl.style.display="block";
			document.getElementById('playlistToggle').setAttribute("class","fa fa-arrow-circle-up");
		}
		else{
			pl.style.display="none";
			document.getElementById('playlistToggle').setAttribute("class","fa fa-arrow-circle-down");
		}
	}
    }
    
    
    
    // This here is the most important function
    /**
     * Generic function to get the tags after they have been loaded after upload
     */
    function showTags(url,file,index) {
      var aud=document.getElementById('sound');
      var med=document.getElementById('media');
      /*VIDEO*/
      if(url.slice(-3)=='ebm'||url.slice(-3)=='mp4'||url.slice(-3)=='mkv'){
	fileNamesLog[index]=url;
	document.getElementById('soundD').setAttribute('style','display:none;');
	aud.pause();aud.currentTime=0;
	document.getElementById('mediaD').setAttribute('style','display:block;');
	document.getElementsByClassName('title')[1].textContent = url; //For Video
	med.src = URL.createObjectURL(file);
	med.play();
      }
      /*AUDIO*/
      else{
	var tags = ID3.getAllTags(url);
	console.log(tags);
	document.getElementById('mediaD').setAttribute('style','display:none;');
	med.pause();med.currentTime=0;
	document.getElementById('soundD').setAttribute('style','display:block;');
	if(tags.title==undefined){
		fileNamesLog[index]=url;
		document.getElementsByClassName('title')[0].textContent = url;
	}
	else{
		fileNamesLog[index]=tags.title;
		document.getElementsByClassName('title')[0].textContent = tags.title;
	}
	document.getElementById('artist').textContent = tags.artist || "";
	document.getElementById('album').textContent = tags.album || "";
	aud.src = URL.createObjectURL(file);
	aud.play();
	var image = tags.picture;
	if (image) {
		var base64String = "";
		for (var i = 0; i < image.data.length; i++) {
			base64String += String.fromCharCode(image.data[i]);
		}
		var base64 = "data:" + image.format + ";base64," +
                window.btoa(base64String);
		document.getElementById('picture').setAttribute('src',base64);
		document.getElementById('picture').setAttribute('alt',url);
	} 
	else {
		document.getElementById('picture').setAttribute('src','images/cplogorArt.png');
		document.getElementById('picture').setAttribute('alt','coolPlay logo');
	}
      }
    }
    
    
    
    /*This tells if or not the video block is active,i.e. currently video(returns 1) or audio(returns 0) is playing*/
    function isVideoActive(){
	if(document.getElementById('mediaD').style.display=='none'){
		return 0;}
	else{
		return 1;}
    }
</script>
</body>
</html>
